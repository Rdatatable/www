<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
</head>
<body>
<!-- <body> -->
<!-- Master nav - DO NOT TOUCH-->
<header>
<div class="navbar-default">
<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
</button>
<nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
<ul class="nav navbar-nav">
<li>
<a href="../"><span class="glyphicon glyphicon-home"></span> data.table</a>
</li>
</ul>
<ul class="nav navbar-nav navbar-left">
<li class="dropdown">
<a class="dropdown-toggle" data-toggle="dropdown" href="#" id="docs"><span class="glyphicon glyphicon-pencil"></span> Get started <span class="caret"></span></a>
<ul class="dropdown-menu" aria-labelledby="docs">
<li>
<a href="../about/">data.table project</a>
</li>
<li>
<a href="../intro/">Quick Introduction</a>
</li>
<li>
<a href="./">Learn with example</a>
</li>
<li>
<a href="../faq/">FAQs</a>
</li>
</ul>
</li>
<li>
<a href="../benchmarks/"><span class="glyphicon glyphicon-wrench"></span> Benchmarks</a>
</li>
<li>
<a href="../gallery/"><span class="glyphicon glyphicon-book"></span> Gallery</a>
</li>
<li>
<a href="../new/"><span class="glyphicon glyphicon-cog"></span> What’s new</a>
</li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
<a class="dropdown-toggle" data-toggle="dropdown" href="#" id="docs"><span class="glyphicon glyphicon-question-sign"></span> How to<span class="caret"></span></a>
<ul class="dropdown-menu" aria-labelledby="docs">
<li>
<a href="../get-involved/">Get involved</a>
</li>
</ul>
</li>
<li>
<a href="../notes/">Release Notes</a>
</li>
</ul>
</nav>
</div>
</header>
<!--body-->
<div class='container bs-docs-container'>
<div class='row'>
<div class='col-md-9' role='main'>
<!-- Introduction -->
<div class='bs-docs-section'>
<h1 id="introduction" class="page-header">
Benchmarks
</h1>
<p > 
This page follows up on an <a href="http://arunsrinivasan.github.io/dplyr_benchmark/">earlier note</a> where we proposed we would provide a range of benchmarks on large data comparing <code>data.table</code> to <code>dplyr</code>. Here we test here on <strong>1,000 times larger</strong> data: <strong>half a billion rows</strong> by <strong>six columns</strong> (<code>~13GB</code>). We still consider 13GB fairly small but it should be big enough to make inferences that hold with even larger data; e.g., some users already have much larger <code>data.table</code>s on machines with over 200GB RAM.
</p>
<div class='bs-callout bs-callout-info' id='datatable-row-limit'>
<ol style="list-style-type: decimal">
<li><code>data.table</code> is currently limited to 2 billion rows; i.e., each column is limited to 8GB (integer) or 16GB (numeric). Since this limit applies to each column, you can have 2 billion rows and 10 integer columns in an 80GB data.table, for example.</li>
<li>All benchmarks timings reported are minimum of <strong>three consecutive runs</strong>. These are benchmarks are relatively huge data; they necessarily take a long time to run (many minutes for a single run, typically).</li>
</ol>
</div>
<h1 id="data-manipulation" class="page-header">
Data manipulation
</h1>
<p > 
We’ll first begin by comparing the most common data manipulation operations between <code>data.table</code> and <code>dplyr</code>. For grouped operations, <code>dplyr</code> provides a function <code4>group_by()</code4> to be combined with dplyr’s verbs, to perform operations on each group. We’ll compare performance both with and without grouping wherever possible.
</p>
<div class='bs-callout bs-callout-info' id='summarise-box-01'>
<h4 id="to-compare-performance-we-will">To compare performance, we will:</h4>
<ol>
<li> 
Group by various combinations of three out of the six columns (<code>id1</code>, <code>id2</code> and <code>id3</code>).
</li>
<li> 
Test with <strong>a)</strong> few groups (100) and <strong>b)</strong> many groups (100, 000).
</li>
<li> 
Test grouping on various types (character, integer and numeric).
</li>
</ol>
</div>
<div class='bs-docs-section'>
<div class='panel-group' id='accordion'>
<div class='panel panel-default'>
<div class='panel-heading'>
<h4 class="panel-title">
<a data-toggle="collapse" data-parent="#accordion" href="#summarise-functions"><span class="glyphicon glyphicon-collapse-down"></span> Here are the functions to generate the test data:</a>
</h4>
</div>
<div id='summarise-functions' class='panel-collapse collapse'>
<div class='panel-body'>
<div class='highlight'>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setup data</span>
<span class="kw">require</span>(data.table) <span class="co"># v1.9.3</span>
<span class="kw">require</span>(dplyr)      <span class="co"># v0.2</span>
<span class="co"># For data.table</span>
getDT &lt;-<span class="st"> </span>function(n, k) {
    <span class="kw">set.seed</span>(45L)
    DT =<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">id1 =</span> <span class="kw">sample</span>(<span class="kw">paste0</span>(<span class="st">&quot;id&quot;</span>, <span class="dv">1</span>:k), n, <span class="ot">TRUE</span>), 
             <span class="dt">id2 =</span> <span class="kw">sample</span>(<span class="fl">1e2</span>, n, <span class="ot">TRUE</span>), 
             <span class="dt">id3 =</span> <span class="kw">as.numeric</span>(<span class="kw">sample</span>(<span class="dv">10</span>, n, <span class="ot">TRUE</span>)), 
             <span class="dt">v1 =</span> <span class="kw">sample</span>(<span class="dv">5</span>, n, <span class="ot">TRUE</span>), 
             <span class="dt">v2 =</span> <span class="kw">sample</span>(<span class="dv">4</span>, n, <span class="ot">TRUE</span>), 
             <span class="dt">v3 =</span> <span class="kw">sample</span>(<span class="dv">4</span>, n, <span class="ot">TRUE</span>))
}
<span class="co"># For dplyr</span>
getDF &lt;-<span class="st"> </span>function(n, k) {
    DF =<span class="st"> </span><span class="kw">tbl_df</span>(<span class="kw">as.data.frame</span>(<span class="kw">getDT</span>(n, k)))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Grouping -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="grouping">
Grouping
</h2>
<p > 
We’ll consider aggregation/grouping operations in this section. The equivalent for <code>dplyr</code> is <code4>summarise</code4>, which summarises each group into a single row.
</p>
<div class='bs-callout bs-callout-info' id='summarise-box-02'>
<h4>
<span class="glyphicon glyphicon-cog"></span> New optimisations in 1.9 - GForce
</h4>
<p > 
From <code4>1.9.0</code4>, <code>data.table</code> also provides <em>much faster</em> optimised methods for <strong>common grouping</strong> operations like <code4>sum</code4>, <code4>mean</code4> etc. See <code>?GForce</code> or alternatively check out the <a href="../new/#GForce">What’s new#GForce</a> section.
</p>
</div>
<!-- summarise summarise -->
<h4 id="summarise_summarise">
Benchmark summary
</h4>
<div class='bs-example table-responsive'>
<!-- no parser for table unfortunately-->
<table class="table table-striped table-bordered table-hover">
<thead>
<tr>
<th>
Get data
</th>
<th>
data.table and dplyr summary functions
</th>
<th>
Package
</th>
<th>
Time elapsed
</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1, 100 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[, lapply(.SD, sum), by=id1, .SDcols=4:6]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
19.4s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1) %&gt;%
</p>
<p class="lead2">
summarise_each(., funs(sum), vars=4:6)
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
38.2s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1, 100,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e5L)
</p>
<p class="lead2">
DF = getDF(5e8, 1e5L)
</p>
</span><br />
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[, lapply(.SD, sum), by=id1, .SDcols=4:6]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
70.1s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1) %&gt;%
</p>
<p class="lead2">
summarise_each(., funs(sum), vars=4:6)
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
148.3s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1,id2, 10,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2L)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2L)
</p>
</span><br />
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[, lapply(.SD, sum), by=“id1,id2”, .SDcols=4:6]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
39.4s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1, id2) %&gt;%
</p>
<p class="lead2">
summarise_each(., funs(sum), vars=4:6)
</p>
</span><br />
</td>
<td>
dplyr
</td>
<td>
89.6s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1,id2,id3, 100,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2L)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2L)
</p>
</span><br />
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[, lapply(.SD, sum), by=“id1,id2,id3”, .SDcols=4:6]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
81.4s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1, id2, id3) %&gt;%
</p>
<p class="lead2">
summarise_each(., funs(sum), vars=4:6)
</p>
</span><br />
</td>
<td>
dplyr
</td>
<td>
209.9s
</td>
</tr>
</tbody>
</table>
</div>
<div class='bs-callout bs-callout-warning' id='summarise-box-03'>
<h4>
<span class="glyphicon glyphicon-bullhorn"></span> data.table is ~2-2.5x faster than dplyr:
</h4>
<p > 
<code>data.table</code> is approximately 2-2.5x faster than <code>dplyr</code> summarising on this large dataset. <code>dplyr</code> optimises <code>sum</code> through hybrid evaluation whereas <code>data.table</code> optimises through GForce.
</p>
</div>
</div>
</div>
</div>
<!-- Ordering -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="ordering">
Ordering
</h2>
<p > 
From versions <code4>1.9.3+</code4>, <code>data.table</code> optimises <code4>DT[order(.)]</code4> internally to use <code>data.table</code>’s fast ordering instead of <code4>base:::order()</code4> and is therefore really fast. This behaves exactly like base’s order in that it also accepts expressions, ex: <code>DT[order(V1-V2)]</code>. We’ll compare it against <code>dplyr</code>’s equivalent <code4>arrange</code4>.
</p>
<!-- Arrange without grouping -->
<h4 id="summarise_arrange">
Benchmark summary
</h4>
<p > 
We’ll benchmark the time taken to reorder the entire <code>data.frame</code> or <code>data.table</code> based on some random combinations of columns. The dataset will remain the same throughout this section.
</p>
<div class='bs-example table-responsive'>
<table class="table table-striped table-bordered table-hover">
<thead>
<tr>
<th>
Get data
</th>
<th>
Order by
</th>
<th>
data.table and dplyr arrange functions
</th>
<th>
Package
</th>
<th>
Time elapsed
</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono"> <span class="text-muted"># character</span>
<p class="lead2">
id1
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[order(id1)]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
114.0s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
arrange(DF, id1)
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
758.5s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">same as above</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono"> <span class="text-muted"># integer</span>
<p class="lead2">
-id2
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[order(-id2)]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
113.2s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
arrange(DF, desc(id2))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
453.3s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">same as above</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono"> <span class="text-muted"># numeric</span>
<p class="lead2">
-id3
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[order(-id3)]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
153.7s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
arrange(DF, desc(id3))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
641.1s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">same as above</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
id1, -id2
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[order(id1, -id2)]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
169.7s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
arrange(DF, id1, desc(id2))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
1440.7s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">same as above</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
-id3, id1, id2
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[order(-id3, id1, id2)]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
468.1s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
arrange(DF, desc(id3), id1, id2)
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
4539.9s
</td>
</tr>
</tbody>
</table>
</div>
<div class='bs-callout bs-callout-warning' id='summarise-box-04'>
<h4>
<span class="glyphicon glyphicon-bullhorn"></span> data.table is ~4-10x faster than dplyr without grouping:
</h4>
<p > 
<code>data.table 1.9</code> implements a <em>much faster</em> radix-based ordering <code>integer</code>, <code>numeric</code>, <code>character</code>, <code>logical</code> and (recently) <code>integer64</code> types and makes available to users as <code4>setorder()</code4> and by optimising <code4>DT[order(.)]</code4> internally.
</p>
</div>
<p > 
In addition, <code4>v1.9.3+</code4> implements a new function <code4>setorder()</code4> which also reorders a <code>data.table</code>, but <strong>by reference</strong>. It is very memory efficient compared to <code4>DT[order(.)]</code4> since no copy is being made at all. By avoiding unnecessary overheads, it is also faster than <code4>DT[order(.)]</code4>. Check the <a href="../new/#setorder">What’s new#setorder</a> section for more explanation and examples.
</p>
</div>
</div>
</div>
<!-- Subsetting -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="subsetting">
Subsetting
</h2>
<p > 
Let’s consider the task of obtaining all rows corresponding to <code4>max(v1)</code4> within each group. Equivalent in <code>dplyr</code> is <code4>filter</code4>.
</p>
<!-- summarise filter -->
<h4 id="summarise_filter">
Benchmark summary (with grouping)
</h4>
<div class='bs-example table-responsive'>
<table class="table table-striped table-bordered table-hover">
<thead>
<tr>
<th>
Data
</th>
<th>
data.table and dplyr filter functions
</th>
<th>
Package
</th>
<th>
Time Elapsed
</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1, 100 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[DT[, .I[v1 == max(v1)], by=id1]$V1]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
66.0s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1) %&gt;% filter(v1 == max(v1))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
91.6s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1, 100,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e5)
</p>
<p class="lead2">
DF = getDF(5e8, 1e5)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[DT[, .I[v1 == max(v1)], by=id1]$V1]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
88.8s<span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1) %&gt;% filter(v1 == max(v1))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
282.0s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1,id2 10,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[DT[, .I[v1 == max(v1)], by=“id1,id2”]$V1]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
117.6s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1,id2) %&gt;% filter(v1 == max(v1))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
143.2s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1,id2,id3 100,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[DT[, .I[v1 == max(v1)], by=“id1,id2,id3”]$V1]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
136.6s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1,id2,id3) %&gt;% filter(v1 == max(v1))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
342.8s
</td>
</tr>
</tbody>
</table>
</div>
<div class='bs-callout bs-callout-warning' id='summarise-box-05'>
<h4 id="data.table-is-1.2x-to-3.2x-faster-than-dplyr"><span class="glyphicon glyphicon-bullhorn"></span> data.table is ~1.2x to ~3.2x faster than dplyr:</h4>
<code4>.I</code4> is a special variable that holds the row number in <code4>DT</code4> for each group. Check out <code4>?data.table</code4> for more information on all special variables.
</div>
</div>
</div>
</div>
<!-- Updating -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="updating">
Updating
</h2>
<p > 
One important difference in the philosophy of <code>data.table</code> with <code>dplyr</code> is that <code>dplyr</code> <em>doesn’t</em> like modifying objects <em>in-place</em>. However it is a very important aspect of <code>data.table's</code> philosophy.
</p>
<div class='bs-callout bs-callout-warning' id='summarise-box-06'>
<h4 id="design-and-performance-trade-offs">Design and performance trade-offs:</h4>
<ol style="list-style-type: decimal">
<li><strong>dplyr</strong> <em>shallow copies</em> the data and then adds or modifies columns. Even though the cost to shallow copy is normally negligible, it does increase with the number of columns. <a href="http://stackoverflow.com/a/21704664/559784">This stackoverflow post</a> gives an idea about the performance due to shallow copy on datasets with huge amounts of columns.</li>
<li>When modifying existing columns, <strong>dplyr</strong> will have to make a <strong>copy</strong> of <em>that column</em> before modifying, due to its <em>design</em>. This’ll affect <em>performance</em>.</li>
<li>To our knowledge, it’s <strong>not</strong> possible currently to modify only a subset of rows (say, based on a condition) using <strong>dplyr</strong> without copying that column. Checkout the <a href="../grammar/#sub-assign-by-reference">grammar#sub-assignment-by-reference</a> section for more information on this topic.</li>
</ol>
</div>
<p > 
Here, we’ll only consider <code4>mutate()</code4> to <code>data.table</code>’s <code4>:=</code4> (or equivalently <code4>set()</code4>) in creating new columns, while grouping. The task we consider is quite simple and straightforward. For each group, normalise all non-grouping columns by that groups’s <code4>max</code4> value. To keep the benchmarks fair, the newly created columns for <code>data.table</code> are removed each time before running again (code not shown).
</p>
<!-- grouped mutate -->
<h4 id="summarise_filter">
Benchmark summary (with grouping)
</h4>
<div class='bs-example table-responsive'>
<table class="table table-striped table-bordered table-hover">
<thead>
<tr>
<th>
Data
</th>
<th>
data.table and dplyr filter functions
</th>
<th>
Package
</th>
<th>
Time Elapsed
</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1, 100 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[, <code>:=</code>(v4 = v1/max(v1)), by = id1]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
20.2s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1) %&gt;% mutate(v4 = v1/max(v1))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
36.0s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1, 100,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e5)
</p>
<p class="lead2">
DF = getDF(5e8, 1e5)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[, <code>:=</code>(v4 = v1/max(v1)), by = id1]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
96.6s<span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1) %&gt;% mutate(v4 = v1/max(v1))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
146.1s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1,id2 10,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[, <code>:=</code>(v4 = v1/max(v1)), by = “id1,id2”]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
50.3s<span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1,id2) %&gt;% mutate(v4 = v1/max(v1))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
88.6s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-muted"># id1,id2,id3 100,000 groups</span> <span class="text-mono">
<p class="lead2">
DT = getDT(5e8, 1e2)
</p>
<p class="lead2">
DF = getDF(5e8, 1e2)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
DT[, <code>:=</code>(v4 = v1/max(v1)), by = “id1,id2,id3”]
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
101.3s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF %&gt;% group_by(id1,id2,id3) %&gt;% mutate(v4=v1/max(v1))
</p>
</span>
</td>
<td>
dplyr
</td>
<td>
204.8s
</td>
</tr>
</tbody>
</table>
</div>
<div class="bs-callout bs-callout-warning" id="summarisef-box-07">
<h4>
<span class="glyphicon glyphicon-bullhorn"></span> data.table is ~1.5x to ~2.25x faster than dplyr:
</h4>
Once again, <code>data.table</code> turns out faster.
</div>
</div>
</div>
</div>
<!-- Conclusion -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="verbs-conclusion">
Conclusion
</h2>
<p class='lead'> 
Yet to be done…
</p>
</div>
</div>
</div>
<!-- joins -->
<div class='bs-docs-section'>
<h1 id="joins" class="page-header">
vs dplyr Joins
</h1>
<p > 
In this section, we’ll benchmark <code>data.table</code> <code4>joins</code4> against <code>dplyr</code>’s. For now, We’ll consider only <code4>left join</code4> for now. We will update with the other joins soon.
</p>
<div class='bs-callout bs-callout-info' id='joins-box-01'>
<h4>
To compare performance, we will:
</h4>
<ol>
<li> 
Construct a large <code>data.table</code> - <strong>5e8 rows</strong> and <strong>five columns</strong> and another <code>data.table</code> which contains the unique values from the first <code>data.table</code> based on the columns to join by.
</li>
<li> 
Generate two different data sets - one with relatively <strong>less</strong> unique groupings (~100-1000) and the other <strong>many</strong> groups (~100,000).
</li>
<li> 
Also test the performance of joins on <strong>multiple columns</strong>. .li
</ol>
</div>
<p > 
The functions required to generate these large datasets (mentioned above) for both <code>data.table</code> and <code>dplyr</code> cases are shown below. Click on the box below to collapse and reveal the code.
</p>
<div class='panel-group' id='accordion'>
<div class='panel panel-default'>
<div class='panel-heading'>
<h4 class="panel-title">
<a data-toggle="collapse" data-parent="#accordion" href="#joins-functions"><span class="glyphicon glyphicon-collapse-down"></span> Here are the functions to generate the required data:</a>
</h4>
</div>
<div id='joins-functions' class='panel-collapse collapse'>
<div class='panel-body'>
<div class='highlight'>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setup data</span>
<span class="co">#require(data.table) # v1.9.3</span>
<span class="co">#require(dplyr)      # v0.2</span>
<span class="co"># For data.table</span>
getDTx &lt;-<span class="st"> </span>function(n, k) {
    <span class="kw">set.seed</span>(45L)
    DT =<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">id1 =</span> <span class="kw">sample</span>(<span class="kw">paste0</span>(<span class="st">&quot;id&quot;</span>, <span class="dv">1</span>:k), n, <span class="ot">TRUE</span>), 
    <span class="dt">id2 =</span> <span class="kw">sample</span>(-k:k, n, <span class="ot">TRUE</span>), 
    <span class="dt">id3 =</span> <span class="kw">as.numeric</span>(<span class="kw">sample</span>(-k:k, n, <span class="ot">TRUE</span>)), 
    <span class="dt">v1 =</span> <span class="kw">sample</span>(<span class="dv">5</span>, n, <span class="ot">TRUE</span>), 
    <span class="dt">v2 =</span> <span class="kw">sample</span>(<span class="dv">4</span>, n, <span class="ot">TRUE</span>))
}
getDTy &lt;-<span class="st"> </span>function(DT, by) <span class="kw">unique</span>(DT, <span class="dt">by=</span>by)[, by, with=<span class="ot">FALSE</span>]
<span class="co"># For dplyr</span>
getDFx &lt;-<span class="st"> </span>function(n, k) {
    DF =<span class="st"> </span><span class="kw">tbl_df</span>(<span class="kw">as.data.frame</span>(<span class="kw">getDTx</span>(n, k)))
}
getDFy &lt;-<span class="st"> </span>function(DT, by) <span class="kw">as.data.frame</span>(<span class="kw">getDTy</span>(DT, by))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Left join -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="left">
Left join
</h2>
<!-- summarise summarise -->
<h4 id="join_left">
Benchmark summary
</h4>
<div class='bs-example table-responsive'>
<table class="table table-striped table-bordered table-hover">
<thead>
<tr>
<th>
Data
</th>
<th>
Join cols + groups
</th>
<th>
data.table and dplyr functions
</th>
<th>
Package
</th>
<th>
Time elapsed
</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
DTx = getDTx(5e8, 100)
</p>
<p class="lead2">
DFx = getDFx(5e8, 100)
</p>
<p class="lead2">
DTy = getDTy(DTx, “id1”)
</p>
<p class="lead2">
DFy = getDFy(DTx, “id1”)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono" align="center">
<p class="lead2">
id1
</p>
<p class="lead2">
100
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
setkeyv(DTx, “id1”)
</p>
<p class="lead2">
setkeyv(DTy, “id1”)
</p>
<p class="lead2">
DTx[DTy]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
84.7s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">left_join(DFy, DFx, by=“id1”)</span>
</td>
<td>
dplyr
</td>
<td>
130.3s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
DTy = getDTy(DTx, “id2”)
</p>
<p class="lead2">
DFy = getDFy(DTx, “id2”)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono" align="center">
<p class="lead2">
id2
</p>
<p class="lead2">
200
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
setkeyv(DTx, “id2”)
</p>
<p class="lead2">
setkeyv(DTy, “id2”)
</p>
<p class="lead2">
DTx[DTy]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
91.5s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">left_join(DFy, DFx, by=“id2”)</span>
</td>
<td>
dplyr
</td>
<td>
142.6s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
DTy = getDTy(DTx, “id3”)
</p>
<p class="lead2">
DFy = getDFy(DTx, “id3”)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono" align="center">
<p class="lead2">
id3
</p>
<p class="lead2">
200
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
setkeyv(DTx, “id3”)
</p>
<p class="lead2">
setkeyv(DTy, “id3”)
</p>
<p class="lead2">
DTx[DTy]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
147.2s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">left_join(DFy, DFx, by=“id3”)</span>
</td>
<td>
dplyr
</td>
<td>
159.8s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
byv = c(“id1”, “id2”)
</p>
<p class="lead2">
DTy = getDTy(DTx, byv)
</p>
<p class="lead2">
DFy = getDFy(DTx, byv)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono" align="center">
<p class="lead2">
id1,id2
</p>
<p class="lead2">
20,000
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
setkeyv(DTx, byv)
</p>
<p class="lead2">
setkeyv(DTy, byv)
</p>
<p class="lead2">
DTx[DTy]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
159.0s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">left_join(DFy, DFx, by=byv)</span>
</td>
<td>
dplyr
</td>
<td>
200.9s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
byv = c(“id1”, “id2”, “id3”)
</p>
<p class="lead2">
DTx = getDTx(5e8, 10)
</p>
<p class="lead2">
DFx = getDFx(5e8, 10)
</p>
<p class="lead2">
DTy = getDTy(DTx, byv)
</p>
<p class="lead2">
DFy = getDFy(DTx, byv)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono" align="center">
<p class="lead2">
id1,id2,id3
</p>
<p class="lead2">
~4,000
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
setkeyv(DTx, byv)
</p>
<p class="lead2">
setkeyv(DTy, byv)
</p>
<p class="lead2">
DTx[DTy]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
188.5s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">left_join(DFy, DFx, by=byv)</span>
</td>
<td>
dplyr
</td>
<td>
252.5s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
byv = c(“id1”, “id2”, “id3”)
</p>
<p class="lead2">
DTx = getDTx(5e8, 30)
</p>
<p class="lead2">
DFx = getDFx(5e8, 30)
</p>
<p class="lead2">
DTy = getDTy(DTx, byv)
</p>
<p class="lead2">
DFy = getDFy(DTx, byv)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono" align="center">
<p class="lead2">
id1,id2,id3
</p>
<p class="lead2">
~100,000
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
setkeyv(DTx, byv)
</p>
<p class="lead2">
setkeyv(DTy, byv)
</p>
<p class="lead2">
DTx[DTy]
</p>
</span><br />
</td>
<td>
<strong>data.table</strong>
</td>
<td>
252.8s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">left_join(DFy, DFx, by=byv)</span>
</td>
<td>
dplyr
</td>
<td>
720.1s
</td>
</tr>
</tbody>
</table> <!-- table -->
</div>
<div class='bs-callout bs-callout-warning' id='joins-box-02'>
<h4>
<span class="glyphicon glyphicon-bullhorn"></span> data.table’s left join is ~1.1-2.8x faster than dplyr:
</h4>
<p > 
<code>data.tabe</code> uses <a href="../new/#binary-search">binary search</a> based approach for joins, where as <code>dplyr</code> uses hash tables. <code>data.table</code>’s choice of algorithm is deliberate because it also has <a href="../grammar#rolling-joins">fast prevailing orderd joins</a> (<code4>roll=TRUE</code4>), a.k.a last observation carried forward, in mind. This additional functionality, which <code>dplyr</code> doesn’t have currently, comes as a natural extension due to binary search based joins without compromising in speed.
</p>
</div>
</div>
</div>
</div>
<!-- Conclusion -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="joins-conclusion">
Conclusion
</h2>
<p class='lead'> 
Yet to be done…
</p>
</div>
</div>
</div>
<!-- left join -->                        
<!-- melt -->
<div class='bs-docs-section'>
<h1 id="reshape" class="page-header">
vs Reshape
</h1>
<p > 
<code>data.table 1.9</code> imports the package <code>reshape2</code> and implements <code>data.table</code> specific methods for both <code4>melt</code4> and <code4>dcast</code4> in <code>C</code>. It’s both fast and memory efficient. We’ll compare them here to with <code>reshape2</code>’s respective methods.
</p>
<h2 id="melt">
Melt
</h2>
<p > 
Here are the functions to generate data.
</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setup data</span>
<span class="kw">require</span>(data.table) <span class="co"># 1.9.3</span>
<span class="kw">require</span>(reshape2)
getDT &lt;-<span class="st"> </span>function(n) {
    <span class="kw">set.seed</span>(45L)
    DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">x =</span> <span class="kw">sample</span>(letters, n, <span class="ot">TRUE</span>), <span class="dt">y =</span> <span class="kw">sample</span>(LETTERS, n, <span class="ot">TRUE</span>),
    <span class="dt">za =</span> <span class="kw">rnorm</span>(n), <span class="dt">zb =</span> <span class="kw">rnorm</span>(n), <span class="dt">zc =</span> <span class="kw">as.numeric</span>(<span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">NA</span>,<span class="dv">1</span>:<span class="dv">5</span>), n, <span class="ot">TRUE</span>)))
}
getDF &lt;-<span class="st"> </span>function(n) <span class="kw">as.data.frame</span>(<span class="kw">getDT</span>(n))</code></pre>
</div>
<p > 
We’ll benchmark on 1e8 rows. Also, we’ll compare <code4>melt</code4> with and without the argument <code4>na.rm</code4>.
</p>
<div class='bs-callout bs-callout-info' id='reshape-box-02'>
<h4>
<span class="glyphicon glyphicon-cog"></span> New optimisations to reshape2’s melt:
</h4>
<p > 
Kevin Ushey has recently added a <a href="https://github.com/hadley/reshape/pull/39">C++</a> version of <code4>melt</code4> to the <code>reshape2</code> package. At the time of writing, it’s still not available on CRAN. We’ll benchmark both <code4>melt</code4> from CRAN version 1.2.2 and the new <code>C++</code> version (commit 148).
</p>
</div>
<!-- melt table -->
<h4 id="reshape_melt">
Benchmark summary
</h4>
<div class='bs-example table-responsive'>
<table class="table table-striped table-bordered table-hover">
<thead>
<tr>
<th>
Data
</th>
<th>
data.table and reshape2’s melt functions
</th>
<th>
Package
</th>
<th>
Time Elapsed
</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
DT = getDT(1e8)
</p>
<p class="lead2">
DF = getDF(1e8)
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
melt(DT, id=1:2)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
6.5s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
melt(DF, id=1:2)
</p>
</span>
</td>
<td>
reshape2 - CRAN
</td>
<td>
457.1s
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
melt(DF, id=1:2)
</p>
</span>
</td>
<td>
reshape2 - new <span class="text-mono">C++</span>
</td>
<td>
9.1s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
same as above
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
melt(DT, id=1:2, na.rm=TRUE)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
8.1s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
melt(DF, id=1:2, na.rm=TRUE)
</p>
</span>
</td>
<td>
reshape2 - CRAN
</td>
<td>
1090.9s
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
melt(DF, id=1:2, na.rm=TRUE)
</p>
</span>
</td>
<td>
reshape2 - new <span class="text-mono">C++</span>
</td>
<td>
109.3s
</td>
</tr>
</tbody>
</table>
</div>
<div class='bs-callout bs-callout-warning' id='reshape-box-03'>
<h4>
<span class="glyphicon glyphicon-bullhorn"></span> melt.data.table is ~1.4x and ~13.5x faster than reshape2’s C++ version of melt
</h4>
<p > 
Note that <code4>melt.data.table</code4> also takes care of removing <code4>NA</code4> (when <code4>na.rm=TRUE</code4>) efficiently from within <code>C</code>, as opposed to the new <code>C++</code> implementation, as is evident from the runtime.
</p>
</div>
<!-- .div -->
<!-- dcast -->
<div class='bs-docs-section'>
<h2 id="dcast">
Cast
</h2>
<p > 
The <code>dcast</code> function from the <code>reshape2</code> package is not a S3 generic yet. Therefore for the moment, we’ll have to use the function as <code4>dcast.data.table</code4>. All arguments except for <code>margins</code> is implemented.
</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setup data</span>
<span class="kw">require</span>(data.table) <span class="co"># 1.9.3</span>
<span class="kw">require</span>(reshape2)
getDT &lt;-<span class="st"> </span>function(n) {
    <span class="kw">set.seed</span>(45L)
    DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">aa =</span> <span class="kw">sample</span>(<span class="fl">1e2</span>, n, <span class="ot">TRUE</span>), <span class="dt">bb =</span> <span class="kw">sample</span>(<span class="fl">1e3</span>, n, <span class="ot">TRUE</span>), 
    <span class="dt">cc =</span> <span class="kw">sample</span>(letters, n, <span class="ot">TRUE</span>), <span class="dt">dd =</span> <span class="kw">runif</span>(n))
}
getDF &lt;-<span class="st"> </span>function(n) <span class="kw">as.data.frame</span>(<span class="kw">getDT</span>(n))</code></pre>
</div>
<p > 
Let’s benchmark on 1e8 rows. Columns <code4>aa</code4> and <code4>bb</code4> both have 1e2 and 1e3 unique values each.
</p>
<!-- dcast table -->
<h4 id="reshape_dcast">
Benchmark summary
</h4>
<div class='bs-example table-responsive'>
<table class="table table-striped table-bordered table-hover">
<thead>
<tr>
<th>
Data
</th>
<th>
Groups
</th>
<th>
data.table and reshape2’s melt functions
</th>
<th>
Package
</th>
<th>
Time Elapsed
</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
DT = getDT(1e8)
</p>
<p class="lead2">
DF = getDF(1e8)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
100
</td>
<td>
<span class="text-mono">
<p class="lead2">
dcast.data.table(DT, aa ~ cc, fun=sum)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
6.9s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
reshape2:::dcast(DF, aa ~ cc, fun=sum)
</p>
</span>
</td>
<td>
reshape2
</td>
<td>
45.2s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
same as above
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
1,000
</td>
<td>
<span class="text-mono">
<p class="lead2">
dcast.data.table(DT, bb ~ cc, fun=sum)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
9.0s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
reshape2:::dcast(DF, bb ~ cc, fun=sum)
</p>
</span>
</td>
<td>
reshape2
</td>
<td>
48.4s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
same as above
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
100,000
</td>
<td>
<span class="text-mono">
<p class="lead2">
dcast.data.table(DT, aa + bb ~ cc, fun=sum)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
20.0s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
reshape2:::dcast(DF, aa + bb ~ cc, fun=sum)
</p>
</span>
</td>
<td>
reshape2
</td>
<td>
144.2
</td>
</tr>
</tbody>
</table>
</div>
<div class='bs-callout bs-callout-warning' id='reshape-box-04'>
<h4>
<span class="glyphicon glyphicon-bullhorn"></span> dcast.data.table is ~5-7x faster than reshape2:::dcast
</h4>
<p > 
<code4>dcast.data.table</code4> takes advantage of <code>data.table's</code> fast ordering, grouping, internal optimisations and binary search for drastic speed-ups. This is also the main reason why reshaping was implemented within <code>data.table</code> as opposed to making a pull request to <code>reshape2</code>.
</p>
</div>
<!-- Conclusion -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="reshape-conclusion">
Conclusion
</h2>
<p > 
Yet to be done..
</p>
</div>
</div>
</div>
<div class='bs-docs-section'>
<h1 id="baseR" class="page-header">
vs base R
</h1>
<p > 
base R’s <code4>unique()</code4> as well as <code4>duplicated()</code4> are a very efficient and extremely fast, when operated on vectors. However their <code>data.frame</code> methods aren’t as efficient and tends to get very slow on relatively large data sizes. In this section, we’d like to highlight the performance gains of these methods implemented in <code>data.table</code>.
</p>
<p > 
Let’s create a data set with 1e8 rows and three columns. We’ll compare <code4>unique()</code4> alone on <code>data.table</code> and <code>data.frame</code> over certain column combinations. Here are the functions to generate the data:
</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For data.table</span>
getDT &lt;-<span class="st"> </span>function(n) {
    <span class="kw">data.table</span>(<span class="dt">x=</span><span class="kw">sample</span>(<span class="dv">100</span>, n, <span class="ot">TRUE</span>), 
    <span class="dt">y=</span><span class="kw">sample</span>(<span class="kw">paste</span>(<span class="st">&quot;id&quot;</span>, <span class="dv">1</span>:<span class="dv">100</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>), n, <span class="ot">TRUE</span>), 
    <span class="dt">z=</span><span class="kw">as.numeric</span>(<span class="kw">sample</span>(-<span class="dv">100</span>:<span class="dv">100</span>, n, <span class="ot">TRUE</span>)))
}
<span class="co"># For dplyr</span>
getDF &lt;-<span class="st"> </span>function(n) <span class="kw">as.data.frame</span>(<span class="kw">getDT</span>(n))</code></pre>
</div>
<h2 id="unique">
Unique
</h2>
<!-- unique table -->
<h4 id="unique_base">
Benchmark summary
</h4>
<div class='bs-example table-responsive'>
<table class="table table-striped table-bordered table-hover">
<thead>
<tr>
<th>
Data
</th>
<th>
Groups
</th>
<th>
data.table and reshape2’s melt functions
</th>
<th>
Package
</th>
<th>
Time Elapsed
</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
DT = getDT(1e8)
</p>
<p class="lead2">
DF = getDF(1e8)
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
<span class="text-muted"># integer</span>
</p>
<p class="lead2" align="center">
x
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
unique(DT, by=“x”)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
1.6s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF[duplicated(DF$x), ]
</p>
</span>
</td>
<td>
base’s unique
</td>
<td>
22.5s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
same as above
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
<span class="text-muted"># character</span>
</p>
<p class="lead2" align="center">
y
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
unique(DT, by=“y”)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
1.4s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF[duplicated(DF$y), ]
</p>
</span>
</td>
<td>
base’s unique
</td>
<td>
23.4s
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
same as above
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
<span class="text-muted"># numeric</span>
</p>
<p class="lead2" align="center">
z
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
unique(DT, by=“z”)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
9.6s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF[duplicated(DF$z), ]
</p>
</span>
</td>
<td>
base’s unique
</td>
<td>
25.6
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
same as above
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2" align="center">
x,y
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
unique(DT, by=c(“x”, “y”))
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
4.2s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF[duplicated(DF[, c(“x”, “y”)]), ]
</p>
</span>
</td>
<td>
base’s unique
</td>
<td>
89.6
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
same as above
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2" align="center">
y, z
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
unique(DT, by=c(“y”, “z”))
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
11.1s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
DF[duplicated(DF[, c(“y”, “z”)]), ]
</p>
</span>
</td>
<td>
base’s unique
</td>
<td>
189.2
</td>
</tr>
</tbody>
<tbody>
<tr>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2">
same as above
</p>
</span>
</td>
<td rowspan="3" style="vertical-align: middle;">
<span class="text-mono">
<p class="lead2" align="center">
x, y, z
</p>
</span>
</td>
<td>
<span class="text-mono">
<p class="lead2">
unique(DT)
</p>
</span>
</td>
<td>
<strong>data.table</strong>
</td>
<td>
12.9s <span class="text-success"><span class="glyphicon glyphicon-ok"></span></span>
</td>
</tr>
<tr>
<td>
<span class="text-mono">
<p class="lead2">
unique(DF)
</p>
</span>
</td>
<td>
base’s unique
</td>
<td>
261.7
</td>
</tr>
</tbody>
</table>
</div>
<div class='bs-callout bs-callout-warning' id='baseR-box-02'>
<h4>
<span class="glyphicon glyphicon-bullhorn"></span> unique.data.table is ~2.5-21x faster than base’s unique:
</h4>
<p > 
<code>data.table</code> gains drastic speed for <code4>unique</code4> and <code4>duplicated</code4> <code>data.table</code> methods once again by using the internal <code>forder</code>.
</p>
</div>
<!-- Conclusion -->
<div class='bs-docs-section'>
<div class='row'>
<div class='col-lg-12'>
<h2 id="baseR-conclusion">
Conclusion
</h2>
<p class='lead'> 
Yet to be done…
</p>
</div>
</div>
</div>
</div>
<!-- col-md-9-->
<div class='col-md-3'>
<div class='bs-sidebar hidden-print' role='complementary'>
<ul class='nav bs-sidenav'>
<li> 
<a href="#introduction">Introduction</a>
</li>
<li>
<a href="#data-manipulation">Data manipulation</a>
<ul class='nav'>
<li> 
<a href="#grouping">Grouping</a>
</li>
<li> 
<a href="#ordering">Ordering</a>
</li>
<li> 
<a href="#subsetting">Subsetting</a>
</li>
<li> 
<a href="#updating">Updating</a>
</li>
<li> 
<a href="#verbs-conclusion">Conclusion</a>
</li>
</ul>
</li>
<li>
<a href="#joins">joins</a>
<ul class='nav'>
<li> 
<a href="#left">Left joins</a>
</li>
<li> 
<a href="#joins-conclusion">Conclusion</a>
</li>
</ul>
</li>
<li>
<a href="#reshape">vs Reshape</a>
<ul class='nav'>
<li> 
<a href="#melt">Melt</a>
</li>
<li> 
<a href="#dcast">Cast</a>
</li>
<li> 
<a href="#reshape-conclusion">Conclusion</a>
</li>
</ul>
</li>
<li>
<a href="#baseR">vs base R</a>
<ul class='nav'>
<li> 
<a href="#unique">Unique</a>
</li>
<li> 
<a href="#baseR-conclusion">Conclusion</a>
</li>
</ul>
</li>
<li> 
<a href="#top">Back to top</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<!--/body-->
<!-- FOOTER - YOU WOULDNT HAVE TO MODIFY THIS PART -->
<footer class="bs-footer" role="contentinfo">
<div class="container">
<iframe src="http://ghbtns.com/github-btn.html?user=Rdatatable&repo=data.table&type=watch&count=true"
allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
<iframe src="http://ghbtns.com/github-btn.html?user=Rdatatable&repo=data.table&type=fork&count=true"
allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
<div class="footer-links">
<ul class="footer-links muted">
<p>
Designed using <a href="http://getbootstrap.com">Bootstrap</a> and styled with <a href="http://bootswatch.com/">Bootswatch</a> using <a href="http://bootswatch.com/cerulean">Cerulean</a> theme.
</p>
<li>
Version 1.9.2
</li>
<li>
·
</li>
<li>
<a href="https://github.com/Rdatatable/data.table">Homepage</a>
</li>
<li>
·
</li>
<li>
<a href="https://github.com/Rdatatable/data.table/graphs/contributors">Contributors</a>
</li>
<li>
·
</li>
<li>
<a href="https://github.com/Rdatatable/data.table/issues?direction=desc&labels=bug&sort=updated&state=open">Issues</a>
</li>
<li>
·
</li>
<li>
<a href="https://github.com/Rdatatable/data.table/issues?direction=desc&labels=feature+request&page=1&sort=updated&state=open">Feature Requests</a>
</li>
<li>
·
</li>
<li>
<a href="https://r-forge.r-project.org/mail/?group_id=240">Mailing list</a>
</li>
<li>
·
</li>
<li>
<a href="http://stackoverflow.com/questions/tagged/r+data.table">Stackoverflow tag</a>
</li>
<span class="pull-right"><a href="#top">Back to top</a></span>
</ul>
</footer>
<script src="https://code.jquery.com/jquery.js"></script>
<script src="../js/waypoints.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/docs.min.js"></script>
<!-- Start of StatCounter Code -->
<script type="text/javascript">
var sc_project=6237851;
var sc_invisible=1;
var sc_security="518c93ca";
</script>
<script type="text/javascript" src="http://www.statcounter.com/counter/counter.js"></script>
<noscript>
<div class="statcounter">
<a title="tumblr stats" href="http://statcounter.com/tumblr/" > <img class="statcounter" src="http://c.statcounter.com/6237851/0/518c93ca/1/" alt="tumblr stats" ></a>
</div>
</noscript>
<!-- End of StatCounter Code -->
</body>
</html>
